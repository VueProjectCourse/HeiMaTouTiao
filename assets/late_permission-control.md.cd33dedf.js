import{_ as n,c as s,o as a,a as t}from"./app.e4ff3064.js";const g='{"title":"\u6743\u9650\u63A7\u5236","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u8DEF\u7531\u7684query\u67E5\u8BE2\u53C2\u6570","slug":"\u8DEF\u7531\u7684query\u67E5\u8BE2\u53C2\u6570"},{"level":2,"title":"\u8DEF\u7531\u5BF9\u8C61\u7684path\u548CfullPath","slug":"\u8DEF\u7531\u5BF9\u8C61\u7684path\u548Cfullpath"},{"level":2,"title":"next\u51FD\u65703\u79CD\u8C03\u7528\u65B9\u5F0F","slug":"next\u51FD\u65703\u79CD\u8C03\u7528\u65B9\u5F0F"},{"level":2,"title":"\u58F0\u660E\u5168\u5C40\u524D\u7F6E\u5B88\u536B","slug":"\u58F0\u660E\u5168\u5C40\u524D\u7F6E\u5B88\u536B"},{"level":2,"title":"\u8BBF\u95EE\u6709\u6743\u9650\u9875\u9762\u65F6\u5224\u65AD\u662F\u5426\u767B\u5F55","slug":"\u8BBF\u95EE\u6709\u6743\u9650\u9875\u9762\u65F6\u5224\u65AD\u662F\u5426\u767B\u5F55"},{"level":2,"title":"\u8BB0\u5F55\u4E0A\u6B21\u8BBF\u95EE\u672A\u9042\u7684\u8DEF\u7531\u5730\u5740","slug":"\u8BB0\u5F55\u4E0A\u6B21\u8BBF\u95EE\u672A\u9042\u7684\u8DEF\u7531\u5730\u5740"}],"relativePath":"late/permission-control.md"}',p={},o=t(`<h1 id="\u6743\u9650\u63A7\u5236" tabindex="-1">\u6743\u9650\u63A7\u5236 <a class="header-anchor" href="#\u6743\u9650\u63A7\u5236" aria-hidden="true">#</a></h1><h2 id="\u8DEF\u7531\u7684query\u67E5\u8BE2\u53C2\u6570" tabindex="-1">\u8DEF\u7531\u7684<code>query</code>\u67E5\u8BE2\u53C2\u6570 <a class="header-anchor" href="#\u8DEF\u7531\u7684query\u67E5\u8BE2\u53C2\u6570" aria-hidden="true">#</a></h2><div class="tip custom-block"><p class="custom-block-title">\u76EE\u6807</p><p>\u8FD9\u4E00\u5C0F\u8282\uFF0C\u6211\u4EEC\u7684\u76EE\u6807\u662F\u56DE\u987E\u8DEF\u7531\u7684 query \u67E5\u8BE2\u53C2\u6570</p></div><div class="warning custom-block"><p class="custom-block-title">\u6B65\u9AA4</p><ol><li>$router.push(&#39;/movie&#39;) \u662F\u4E0D\u5E26\u67E5\u8BE2\u53C2\u6570\u7684\u8DEF\u7531\u8DF3\u8F6C</li><li>$router.push(&#39;/movie?id=9&#39;) \u662F\u5E26\u67E5\u8BE2\u53C2\u6570\u7684\u8DEF\u7531\u8DF3\u8F6C</li><li>\u5728\u8DEF\u7531\u7EC4\u4EF6\u4E2D,\u901A\u8FC7 <a href="http://this.$route.query.xxx" target="_blank" rel="noopener noreferrer">this.$route.query.xxx</a> \u8BBF\u95EE\u67E5\u8BE2\u53C2\u6570\u7684\u503C</li><li>query \u67E5\u8BE2\u53C2\u6570\u7684\u4F18\u52BF\uFF1A\u5728\u4E0D\u4FEE\u6539\u8DEF\u7531\u89C4\u5219\u7684\u524D\u63D0\u4E0B\uFF0C\u7ED9\u8DEF\u7531\u7EC4\u4EF6\u4F20\u9012\u53C2\u6570\u3002</li></ol></div><div class="info custom-block"><p class="custom-block-title">\u4F53\u9A8C</p><ul><li><strong>Step.1\uFF1A$router.push(&#39;/movie&#39;) \u662F\u4E0D\u5E26\u67E5\u8BE2\u53C2\u6570\u7684\u8DEF\u7531\u8DF3\u8F6C</strong></li><li><strong>Step.2\uFF1A$router.push(&#39;/movie?id=9&#39;) \u662F\u5E26\u67E5\u8BE2\u53C2\u6570\u7684\u8DEF\u7531\u8DF3\u8F6C</strong></li><li><strong>Step.3\uFF1A\u5728\u8DEF\u7531\u7EC4\u4EF6\u4E2D,\u901A\u8FC7 <a href="http://this.$route.query.xxx" target="_blank" rel="noopener noreferrer">this.$route.query.xxx</a> \u8BBF\u95EE\u67E5\u8BE2\u53C2\u6570\u7684\u503C</strong></li></ul><div class="language-js"><pre><code><span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id <span class="token comment">// \u8F93\u51FA 9</span>
</code></pre></div><ul><li><strong>Step.4\uFF1Aquery \u67E5\u8BE2\u53C2\u6570\u7684\u4F18\u52BF\uFF1A\u5728\u4E0D\u4FEE\u6539\u8DEF\u7531\u89C4\u5219\u7684\u524D\u63D0\u4E0B\uFF0C\u7ED9\u8DEF\u7531\u7EC4\u4EF6\u4F20\u9012\u53C2\u6570\u3002</strong></li></ul></div><div class="danger custom-block"><p class="custom-block-title">\u603B\u7ED3</p><ul><li>\u3010\u91CD\u70B9\u3011</li><li>\u3010\u96BE\u70B9\u3011</li><li>\u3010\u6CE8\u610F\u70B9\u3011</li><li>\u3010\u9762\u8BD5\u9898\u3011</li></ul></div><h2 id="\u8DEF\u7531\u5BF9\u8C61\u7684path\u548Cfullpath" tabindex="-1">\u8DEF\u7531\u5BF9\u8C61\u7684<code>path</code>\u548C<code>fullPath</code> <a class="header-anchor" href="#\u8DEF\u7531\u5BF9\u8C61\u7684path\u548Cfullpath" aria-hidden="true">#</a></h2><div class="tip custom-block"><p class="custom-block-title">\u76EE\u6807</p><p>\u8FD9\u4E00\u5C0F\u8282\uFF0C\u6211\u4EEC\u7684\u76EE\u6807\u662F\u56DE\u987E\u8DEF\u7531\u5BF9\u8C61\u7684<code>path</code>\u548C<code>fullPath</code></p></div><div class="warning custom-block"><p class="custom-block-title">\u6B65\u9AA4</p><blockquote><p>\u5047\u8BBE\u8BBF\u95EE\u7684\u8DEF\u7531\u5730\u5740\u662F /movie?id=3</p></blockquote><ol><li>$route.path \u662F\u5B57\u7B26\u4E32\uFF0C\u5BF9\u5E94\u5F53\u524D\u8DEF\u7531\u7684\u8DEF\u5F84\u3002\u503C\u662F /movie</li><li>$route.fullPath \u662F\u5B57\u7B26\u4E32\uFF0C\u5305\u542B\u67E5\u8BE2\u53C2\u6570\u548C hash \u7684\u5B8C\u6574\u8DEF\u5F84\u3002\u503C\u662F /movie?id=3</li><li>\u7ED3\u8BBA\uFF1A\u5982\u679C\u60F3\u8981\u83B7\u53D6\u5230\u5B8C\u6574\u7684\u8DEF\u5F84\u5730\u5740\uFF0C\u63A8\u8350\u4F7F\u7528 fullPath\uFF1B\u5982\u679C\u53EA\u5E0C\u671B\u83B7\u53D6\u5230 / \u76F8\u5173\u7684\u8DEF\u5F84\u90E8\u5206\uFF0C\u63A8\u8350\u4F7F\u7528 path\u3002</li></ol></div><div class="danger custom-block"><p class="custom-block-title">\u603B\u7ED3</p><ul><li>\u3010\u91CD\u70B9\u3011</li><li>\u3010\u96BE\u70B9\u3011</li><li>\u3010\u6CE8\u610F\u70B9\u3011</li><li>\u3010\u9762\u8BD5\u9898\u3011</li></ul></div><h2 id="next\u51FD\u65703\u79CD\u8C03\u7528\u65B9\u5F0F" tabindex="-1"><code>next</code>\u51FD\u65703\u79CD\u8C03\u7528\u65B9\u5F0F <a class="header-anchor" href="#next\u51FD\u65703\u79CD\u8C03\u7528\u65B9\u5F0F" aria-hidden="true">#</a></h2><div class="tip custom-block"><p class="custom-block-title">\u76EE\u6807</p><p>\u8FD9\u4E00\u5C0F\u8282\uFF0C\u6211\u4EEC\u7684\u76EE\u6807\u662F\u56DE\u987E\u8DEF\u7531<code>next</code>\u51FD\u65703\u79CD\u8C03\u7528\u65B9\u5F0F</p></div><div class="warning custom-block"><p class="custom-block-title">\u6B65\u9AA4</p><ol><li>\u653E\u884C\u64CD\u4F5C</li><li>\u5F3A\u5236\u8DF3\u8F6C</li><li>\u963B\u6B62\u8DF3\u8F6C</li></ol></div><div class="info custom-block"><p class="custom-block-title">\u4F53\u9A8C</p><ul><li><strong>Step.1\uFF1A\u653E\u884C\u64CD\u4F5C</strong><blockquote><p>\u76F4\u63A5\u8C03\u7528 next() \u51FD\u6570\uFF0C\u8868\u793A\u653E\u884C</p></blockquote></li></ul><div class="language-js"><pre><code>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">&#39;/movie&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u653E\u884C&#39;</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><strong>Step.2\uFF1A\u5F3A\u5236\u8DF3\u8F6C</strong></li></ul><blockquote><p>next(&#39;\u8DEF\u7531\u5730\u5740&#39;) \u8868\u793A\u5F3A\u5236\u8DF3\u8F6C\u5230\u6307\u5B9A\u8DEF\u7531</p></blockquote><div class="language-js"><pre><code>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">&#39;/movie&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u5F3A\u5236\u8DF3\u8F6C\u5230\u767B\u5F55&#39;</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p><strong>Step.3\uFF1A\u963B\u6B62\u8DF3\u8F6C</strong></p><blockquote><p>next(false) \u8868\u793A\u963B\u6B62\u8DEF\u7531\u8DF3\u8F6C\uFF0C\u5F3A\u5236\u7528\u6237\u505C\u7559\u5728\u5F53\u524D\u8DEF\u7531</p></blockquote></li></ul><div class="language-js"><pre><code>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">&#39;/movie&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u963B\u6B62\u8DF3\u8F6C&#39;</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div><div class="danger custom-block"><p class="custom-block-title">\u603B\u7ED3</p><ul><li>\u3010\u91CD\u70B9\u3011</li><li>\u3010\u96BE\u70B9\u3011</li><li>\u3010\u6CE8\u610F\u70B9\u3011</li><li>\u3010\u9762\u8BD5\u9898\u3011</li></ul></div><h2 id="\u58F0\u660E\u5168\u5C40\u524D\u7F6E\u5B88\u536B" tabindex="-1">\u58F0\u660E\u5168\u5C40\u524D\u7F6E\u5B88\u536B <a class="header-anchor" href="#\u58F0\u660E\u5168\u5C40\u524D\u7F6E\u5B88\u536B" aria-hidden="true">#</a></h2><div class="tip custom-block"><p class="custom-block-title">\u76EE\u6807</p><p>\u8FD9\u4E00\u5C0F\u8282\uFF0C\u6211\u4EEC\u7684\u76EE\u6807\u662F\u58F0\u660E\u5168\u5C40\u524D\u7F6E\u5B88\u536B</p><p>\u53EF\u4EE5\u53C2\u8003<a href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%85%A8%E5%B1%80%E5%89%8D%E7%BD%AE%E5%AE%88%E5%8D%AB" target="_blank" rel="noopener noreferrer">\u5168\u5C40\u524D\u7F6E\u5B88\u536B</a>\u7684\u5B98\u65B9\u6587\u6863\u8FDB\u884C\u4F7F\u7528</p></div><div class="warning custom-block"><p class="custom-block-title">\u6B65\u9AA4</p><ol><li>\u5728\u8DEF\u7531\u6A21\u5757\u4E2D\uFF0C\u4E3A <code>router</code> \u5BF9\u8C61\u6302\u8F7D\u5168\u5C40\u524D\u7F6E\u5B88\u536B</li><li>\u628A\u6709\u6743\u9650\u9875\u9762\u7684\u8DEF\u5F84\u62BD\u79BB\u5230\u6570\u7EC4\u4E2D</li></ol></div><div class="info custom-block"><p class="custom-block-title">\u4F53\u9A8C</p><ul><li><strong>Step.1\uFF1A\u5728\u8DEF\u7531\u6A21\u5757\u4E2D\uFF0C\u4E3A <code>router</code> \u5BF9\u8C61\u6302\u8F7D\u5168\u5C40\u524D\u7F6E\u5B88\u536B</strong></li></ul><div class="language-js"><pre><code><span class="token comment">// 1. \u521B\u5EFA\u8DEF\u7531\u7684\u5B9E\u4F8B\u5BF9\u8C61</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 2. \u4E3A\u8DEF\u7531\u7684\u5B9E\u4F8B\u5BF9\u8C61\u6302\u8F7D\u5168\u5C40\u524D\u7F6E\u5B88\u536B</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">&#39;/user&#39;</span> <span class="token operator">||</span> to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">&#39;/user/edit&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 2.1 \u8BBF\u95EE\u7684\u662F\u6709\u6743\u9650\u7684\u9875\u9762\uFF0C\u9700\u8981\u5224\u65AD\u7528\u6237\u662F\u5426\u767B\u5F55</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 2.2 \u8BBF\u95EE\u7684\u662F\u6CA1\u6709\u6743\u9650\u7684\u9875\u9762</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><strong>Step.2\uFF1A\u628A\u6709\u6743\u9650\u9875\u9762\u7684\u8DEF\u5F84\u62BD\u79BB\u5230\u6570\u7EC4\u4E2D</strong></li></ul><div class="language-js"><pre><code><span class="token comment">// \u6240\u6709\u6709\u6743\u9650\u9875\u9762\u7684\u8DEF\u5F84\uFF0C\u90FD\u5728\u8FD9\u4E2A\u6570\u7EC4\u4E4B\u4E2D</span>
<span class="token keyword">const</span> pagePathArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;/user&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/user/edit&#39;</span><span class="token punctuation">]</span>

<span class="token comment">// \u4E3A\u8DEF\u7531\u7684\u5B9E\u4F8B\u5BF9\u8C61\u6302\u8F7D\u5168\u5C40\u524D\u7F6E\u5B88\u536B</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pagePathArr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8BBF\u95EE\u7684\u662F\u6709\u6743\u9650\u7684\u9875\u9762\uFF0C\u9700\u8981\u5224\u65AD\u7528\u6237\u662F\u5426\u767B\u5F55</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8BBF\u95EE\u7684\u662F\u6CA1\u6709\u6743\u9650\u7684\u9875\u9762</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div><div class="danger custom-block"><p class="custom-block-title">\u603B\u7ED3</p><ul><li>\u3010\u91CD\u70B9\u3011</li><li>\u3010\u96BE\u70B9\u3011</li><li>\u3010\u6CE8\u610F\u70B9\u3011</li><li>\u3010\u9762\u8BD5\u9898\u3011</li></ul></div><h2 id="\u8BBF\u95EE\u6709\u6743\u9650\u9875\u9762\u65F6\u5224\u65AD\u662F\u5426\u767B\u5F55" tabindex="-1">\u8BBF\u95EE\u6709\u6743\u9650\u9875\u9762\u65F6\u5224\u65AD\u662F\u5426\u767B\u5F55 <a class="header-anchor" href="#\u8BBF\u95EE\u6709\u6743\u9650\u9875\u9762\u65F6\u5224\u65AD\u662F\u5426\u767B\u5F55" aria-hidden="true">#</a></h2><div class="tip custom-block"><p class="custom-block-title">\u76EE\u6807</p><p>\u8FD9\u4E00\u5C0F\u8282\uFF0C\u6211\u4EEC\u7684\u76EE\u6807\u662F\u8BBF\u95EE\u6709\u6743\u9650\u9875\u9762\u65F6\u5224\u65AD\u662F\u5426\u767B\u5F55</p></div><div class="warning custom-block"><p class="custom-block-title">\u6B65\u9AA4</p><ol><li>\u5728\u8DEF\u7531\u6A21\u5757\u7684\u5934\u90E8\u5BFC\u5165 <code>vuex</code> \u6A21\u5757</li><li>\u5728\u5BFC\u822A\u5B88\u536B\u4E2D\uFF0C\u4ECE <code>store</code> \u4E2D\u83B7\u53D6 <code>token</code> \u7684\u503C\uFF0C\u5E76\u5728\u7528\u6237\u8BBF\u95EE\u6709\u6743\u9650\u7684\u9875\u9762\u65F6\uFF0C\u5224\u65AD <code>token</code> \u7684\u503C\u662F\u5426\u5B58\u5728</li><li>\u89E3\u51B3 <code>vue-router</code> \u5185\u90E8\u7684\u62A5\u9519\u7684\u95EE\u9898</li></ol></div><div class="info custom-block"><p class="custom-block-title">\u4F53\u9A8C</p><ul><li><strong>Step.1\uFF1A\u5728\u8DEF\u7531\u6A21\u5757\u7684\u5934\u90E8\u5BFC\u5165 <code>vuex</code> \u6A21\u5757</strong></li></ul><div class="language-js"><pre><code><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&#39;@/store/index.js&#39;</span>
</code></pre></div><ul><li><strong>Step.2\uFF1A\u5728\u5BFC\u822A\u5B88\u536B\u4E2D\uFF0C\u4ECE <code>store</code> \u4E2D\u83B7\u53D6 <code>token</code> \u7684\u503C\uFF0C\u5E76\u5728\u7528\u6237\u8BBF\u95EE\u6709\u6743\u9650\u7684\u9875\u9762\u65F6\uFF0C\u5224\u65AD <code>token</code> \u7684\u503C\u662F\u5426\u5B58\u5728</strong></li></ul><div class="language-js"><pre><code><span class="token comment">// \u6240\u6709\u6709\u6743\u9650\u9875\u9762\u7684\u8DEF\u5F84\uFF0C\u90FD\u5728\u8FD9\u4E2A\u6570\u7EC4\u4E4B\u4E2D</span>
<span class="token keyword">const</span> pagePathArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;/user&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/user/edit&#39;</span><span class="token punctuation">]</span>

<span class="token comment">// \u4E3A\u8DEF\u7531\u7684\u5B9E\u4F8B\u5BF9\u8C61\u6302\u8F7D\u5168\u5C40\u524D\u7F6E\u5B88\u536B</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u8BBF\u95EE\u7684\u662F\u6709\u6743\u9650\u7684\u9875\u9762\uFF0C\u9700\u8981\u5224\u65AD\u7528\u6237\u662F\u5426\u767B\u5F55</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pagePathArr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. \u4ECE store \u4E2D\u83B7\u53D6 token \u7684\u503C</span>
    <span class="token comment">//    \u6CE8\u610F\uFF1Astore.state.tokenInfo \u8981\u4E48\u662F {} \u7A7A\u5BF9\u8C61\uFF0C\u8981\u4E48\u662F\u5305\u542B {token, refresh_token} \u7684\u5BF9\u8C61</span>
    <span class="token keyword">const</span> tokenStr <span class="token operator">=</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>tokenInfo<span class="token punctuation">.</span>token
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tokenStr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 1.1 token \u6709\u503C\uFF0C\u5DF2\u767B\u5F55\u8FC7\uFF08\u64CD\u4F5C\uFF1A\u76F4\u63A5\u653E\u884C\uFF09</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 1.2 token \u4E0D\u5B58\u5728\uFF0C\u6CA1\u6709\u767B\u5F55\uFF08\u64CD\u4F5C\uFF1A\u5F3A\u5236\u8DF3\u8F6C\u5230\u767B\u5F55\u9875\uFF09</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8BBF\u95EE\u7684\u662F\u6CA1\u6709\u6743\u9650\u7684\u9875\u9762</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><strong>Step.3\uFF1A\u89E3\u51B3 <code>vue-router</code> \u5185\u90E8\u7684\u62A5\u9519\u7684\u95EE\u9898</strong></li></ul><div class="language-js"><pre><code><span class="token comment">// 1. \u5C06 VueRouter \u672C\u8EAB\u63D0\u4F9B\u7684 $router.push \u65B9\u6CD5\u8F6C\u5B58\u5230\u5E38\u91CF\u4E2D</span>
<span class="token keyword">const</span> originalPush <span class="token operator">=</span> <span class="token class-name">VueRouter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>push
<span class="token comment">// 2. \u81EA\u5B9A\u4E49 $router.push \u65B9\u6CD5\uFF0C\u5728\u5185\u90E8\u8C03\u7528\u539F\u751F\u7684 originalPush \u65B9\u6CD5\u8FDB\u884C\u8DEF\u7531\u8DF3\u8F6C\uFF1B\u5E76\u901A\u8FC7 .catch \u6355\u83B7\u9519\u8BEF</span>
<span class="token class-name">VueRouter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">push</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token parameter">location<span class="token punctuation">,</span> onResolve<span class="token punctuation">,</span> onReject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>onResolve <span class="token operator">||</span> onReject<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">originalPush</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> location<span class="token punctuation">,</span> onResolve<span class="token punctuation">,</span> onReject<span class="token punctuation">)</span>
  <span class="token comment">// \u901A\u8FC7 .catch \u6355\u83B7\u9519\u8BEF</span>
  <span class="token keyword">return</span> <span class="token function">originalPush</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div><div class="danger custom-block"><p class="custom-block-title">\u603B\u7ED3</p><ul><li>\u3010\u91CD\u70B9\u3011</li><li>\u3010\u96BE\u70B9\u3011</li><li>\u3010\u6CE8\u610F\u70B9\u3011</li><li>\u3010\u9762\u8BD5\u9898\u3011</li></ul></div><h2 id="\u8BB0\u5F55\u4E0A\u6B21\u8BBF\u95EE\u672A\u9042\u7684\u8DEF\u7531\u5730\u5740" tabindex="-1">\u8BB0\u5F55\u4E0A\u6B21\u8BBF\u95EE\u672A\u9042\u7684\u8DEF\u7531\u5730\u5740 <a class="header-anchor" href="#\u8BB0\u5F55\u4E0A\u6B21\u8BBF\u95EE\u672A\u9042\u7684\u8DEF\u7531\u5730\u5740" aria-hidden="true">#</a></h2><div class="tip custom-block"><p class="custom-block-title">\u76EE\u6807</p><p>\u8FD9\u4E00\u5C0F\u8282\uFF0C\u6211\u4EEC\u7684\u76EE\u6807\u662F\u8BB0\u5F55\u4E0A\u6B21\u8BBF\u95EE\u672A\u9042\u7684\u8DEF\u7531\u5730\u5740\uFF0C\u6BD4\u5982:</p><blockquote><p>\u5982\u679C\u7528\u6237\u6CA1\u6709\u767B\u5F55\uFF0C\u8981\u8BBF\u95EE <code>/user</code> \u5730\u5740\uFF0C\u5219\u4F1A\u5F3A\u5236\u8DF3\u8F6C\u5230 <code>/login</code> \u767B\u5F55\u9875 \u5F53\u7528\u6237\u767B\u5F55\u6210\u529F\u4E4B\u540E\uFF0C\u5E94\u8BE5\u81EA\u52A8\u8DF3\u8F6C\u5230\u7528\u6237\u521A\u624D\u8BBF\u95EE\u672A\u9042\u7684\u8DEF\u7531\u5730\u5740\uFF0C\u5373\uFF1A\u767B\u5F55\u6210\u529F\u4E4B\u540E\uFF0C\u8DF3\u8F6C\u5230 <code>/user</code></p></blockquote></div><div class="warning custom-block"><p class="custom-block-title">\u6B65\u9AA4</p><ol><li>\u5728\u8DEF\u7531\u6A21\u5757\u7684\u5BFC\u822A\u5B88\u536B\u4E2D\uFF0C\u4FEE\u6539\u5F3A\u5236\u8DF3\u8F6C\u5230\u767B\u5F55\u7684\u4EE3\u7801</li><li>\u5728 <code>Login</code> \u7EC4\u4EF6\u4E2D\uFF0C\u8FDB\u4E00\u6B65\u6539\u9020\u767B\u5F55\u7684\u65B9\u6CD5</li></ol></div><div class="info custom-block"><p class="custom-block-title">\u4F53\u9A8C</p><ul><li><strong>Step.1\uFF1A\u5728\u8DEF\u7531\u6A21\u5757\u7684\u5BFC\u822A\u5B88\u536B\u4E2D\uFF0C\u4FEE\u6539\u5F3A\u5236\u8DF3\u8F6C\u5230\u767B\u5F55\u7684\u4EE3\u7801</strong></li></ul><div class="language-js"><pre><code><span class="token comment">// before\uFF1A\u6CA1\u6709\u767B\u5F55\uFF0C\u5F3A\u5236\u8DF3\u8F6C\u5230\u767B\u5F55\u9875</span>
<span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// now\uFF1A\u6CA1\u6709\u767B\u5F55\uFF0C\u5F3A\u5236\u8DF3\u8F6C\u5230\u767B\u5F55\u9875\uFF0C\u5E76\u643A\u5E26\u8DEF\u7531\u7684 &quot;query \u67E5\u8BE2\u53C2\u6570&quot;</span>
<span class="token function">next</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/login?pre=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>to<span class="token punctuation">.</span>fullPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
</code></pre></div><ul><li><strong>Step.2\uFF1A\u5728 <code>Login</code> \u7EC4\u4EF6\u4E2D\uFF0C\u8FDB\u4E00\u6B65\u6539\u9020\u767B\u5F55\u7684\u65B9\u6CD5</strong></li></ul><div class="language-js"><pre><code><span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u53EA\u6709\u5F53\u8868\u5355\u6570\u636E\u6821\u9A8C\u901A\u8FC7\u4E4B\u540E\uFF0C\u624D\u4F1A\u8C03\u7528\u6B64 login \u51FD\u6570</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> res <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">loginAPI</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">)</span>

  <span class="token comment">// \u5224\u65AD\u662F\u5426\u767B\u5F55\u6210\u529F\u4E86</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>message <span class="token operator">===</span> <span class="token string">&#39;OK&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. \u628A\u767B\u5F55\u6210\u529F\u7684\u7ED3\u679C\uFF0C\u5B58\u50A8\u5230 vuex \u4E2D</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateTokenInfo</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>

    <span class="token comment">// 2. \u8981\u8DF3\u8F6C\u5230\u9996\u9875</span>
    <span class="token keyword">const</span> navPath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>pre <span class="token operator">||</span> <span class="token string">&#39;/&#39;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>navPath<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div><div class="danger custom-block"><p class="custom-block-title">\u603B\u7ED3</p><ul><li>\u3010\u91CD\u70B9\u3011</li><li>\u3010\u96BE\u70B9\u3011</li><li>\u3010\u6CE8\u610F\u70B9\u3011</li><li>\u3010\u9762\u8BD5\u9898\u3011</li></ul></div>`,30),e=[o];function c(l,u,i,k,r,d){return a(),s("div",null,e)}var h=n(p,[["render",c]]);export{g as __pageData,h as default};
